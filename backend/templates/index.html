<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Time Series Forecast</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        h1 { font-size: 24px; }
        label, select { font-size: 16px; }
        table { border-collapse: collapse; width: 60%; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
        th { background-color: #f2f2f2; }
        img { margin-top: 30px; max-width: 100%; height: auto; display: block; }
    </style>
</head>
<body>
    <h1>ðŸ“ˆ Forecast a Time Series Column</h1>

    <label for="columnSelect">Choose a column to forecast:</label>
    <select id="columnSelect">
        <option value="Space economy1">Space economy1</option>
        <option value="Manufacturing">Manufacturing</option>
        <option value="Durable goods">Durable goods</option>
        <option value="Nondurable goods">Nondurable goods</option>
    </select>

    <button onclick="fetchForecast()">Forecast</button>

    <div id="forecastOutput" style="margin-top: 30px;">
        <h2>Forecast Table</h2>
        <div id="forecastTable"></div>

        <h2>Forecast Plot</h2>
        <img id="forecastPlot" alt="Forecast Plot" />
    </div>

    <script>
        function fetchForecast() {
            const column = document.getElementById('columnSelect').value;
            const encodedColumn = encodeURIComponent(column);  // handle spaces

            fetch(`/forecast/${encodedColumn}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Failed to fetch forecast");
                    }
                    return response.json();
                })
                .then(data => {
                    // Update forecast table
                    const tableDiv = document.getElementById('forecastTable');
                    const dates = data.forecast.dates;
                    const values = data.forecast.values;

                    let html = '<table><tr><th>Date</th><th>Forecast Value</th></tr>';
                    for (let i = 0; i < dates.length; i++) {
                        html += `<tr><td>${dates[i]}</td><td>${values[i].toFixed(2)}</td></tr>`;
                    }
                    html += '</table>';
                    tableDiv.innerHTML = html;

                    // Update plot image
                    document.getElementById('forecastPlot').src = 'data:image/png;base64,' + data.plot_base64;
                })
                .catch(error => {
                    document.getElementById('forecastTable').innerHTML = `<p style="color:red;">${error.message}</p>`;
                    document.getElementById('forecastPlot').src = '';
                });
        }
    </script>
</body>
</html>
